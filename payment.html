<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Big Basket - Checkout Page</title>
    <link rel="stylesheet" href="./styles/payment.css">
    <style></style>
  </head>
  <body>
    <!-- Navbar -->
    <!-- <div id="a_navbar">
      <div class="logo">
        <a href="myheader.html"
          ><img
            src="https://www.bigbasket.com/static/v2489/common/img/bb_logo.png"
            alt=""
        /></a>
      </div>
      <div class="careNum">
        <h2>1860 123 1000</h2>
      </div>
    </div>
    <hr /> -->

    <div id="p_smallHeader">
      <img src="https://www.bbassets.com/static/v2531/custPage/build/content/img/bb_logo.png" alt="">
    </div>

    <!-- Body of Payment Page -->
    <div id="a_body">
      <!-- Address  personal Details -->
      <form id="a_left">
        <h3>Personal Details</h3>
        <div id="a_personal">
          <p>Enter first name</p>
          <p>Enter last name</p>
          <p>Enter contact number</p>
          <input class="aInput" type="text" id="aFname" required />
          <input class="aInput" type="text" id="aLname" required />
          <input class="aInput" type="number" id="aNumber" required />
        </div>
        <h3>Address Details</h3>
        <div id="a_address">
          <p>House number</p>
          <p>Enter apartment name</p>
          <input class="aInput" type="text"/>
          <input class="aInput" type="text" />
          <p>Enter street details</p>
          <p>Enter landmark for easy reach out</p>
          <input class="aInput" type="text" id="aStreet" />
          <input class="aInput" type="text" id="aLandmark" />
        </div>
        <div id="a_select">
          <p>Enter city name</p>
          <p>Area detail</p>
          <p>Enter Pincode</p>
          <select name="" class="aSelect">
            <option value="mumbai">Mumbai</option>
            <option value="pune">Pune</option>
            <option value="banglore">Banglore</option>
            <option value="hyderabad">Hyderabad</option>
            <option value="chennai">Chennai</option>
          </select>
          <select name="" class="aSelect">
            <option value="andheri">Andheri</option>
            <option value="bandra">Bandra</option>
            <option value="goregaon">Goregaon</option>
            <option value="juhu">Juhu</option>
            <option value="borivalli">Borivalli</option>
          </select>
          <input class="aInput" type="number" required />
        </div>
        <div>
          <p style="margin-left: 0px">Choose nick name for this address</p>
          <select name="" class="aSelect">
            <option value="home">HOME</option>
            <option value="office">OFFICE</option>
            <option value="other">OTHER</option>
          </select>
        </div>
        <div>
          <p>
            <input class="aInput" type="checkbox" id="aAddress" /> Set this as
            my default delevery address
          </p>
        </div>
        <div id="aAddCancel">
          <button>ADD ADDRESS</button>
          <button>CANCEL</button>
        </div>
      </form>

      <!-- Apply Voucher & Order Summary-->
      <div id="a_right">
        <h3>Apply Voucher</h3>
        <div id="aTop">
          <input
            id="aVoucher"
            type="text"
            placeholder="Enter voucher code"
            required
          />
          <button id="aApply" onclick="apply('basket20')">Apply</button>
        </div>
        <h3>Order Summary</h3>
        <div id="aOrderSummary">
          <div class="aSummary">
            <p>Basket Value</p>
            <div class="aPrice">
              <!-- <p>Rs</p> -->
              <p id="aBasketPrice">Rs. 1000</p>
            </div>
          </div>
          <div class="aSummary">
            <p>Delevery Charge</p>
            <div class="aPrice">
              <!-- <p>Rs</p> -->
              <p id="aDeleveryCharge">Rs. 50</p>
            </div>
          </div>
          <hr />
          <div class="aSummary">
            <h3>Total Amount Payable</h3>
            <div class="aPrice">
              <!-- <h3>Rs</h3> -->
              <h3 id="aTotalAmount">Rs 1000</h3>
            </div>
          </div>
          <div class="aSummary" id="aSavingsDiv">
            <p>Total Savings</p>
            <div class="aPrice">
              <!-- <p>Rs</p> -->
              <p id="aTotalSaving">Rs. 0</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Credit / Debit Payment -->
    <div id="ap_main">
      <h3>Payment Option</h3>
      <div id="a_payment">
        <div id="ap_left">
          <button id="a_credit" onclick="cardPay()">Credit / Debit Card</button>
          <button>Netbanking</button>
          <button>UPI</button>
          <button>Wallet</button>
          <button>Pay Later</button>
          <button>Cash/Card on Delevery</button>
        </div>
        <div id="ap_right"></div>
      </div>
    </div>
  </body>
</html>
<script>
  let payDetail = document.getElementById('ap_right');

  // Checking Hardcoded Card Details
  const order = () => {
    let cardNumber = document.getElementById('a_cardNumber').value;
    let valid = document.getElementById('a_valid').value;
    let cvv = document.getElementById('acvv').value;
    console.log(cardNumber, valid, cvv);
    if (cardNumber == '1234-5678-9123' && valid == '2022-01' && cvv == '123') {
      window.location.href = 'otp.html';
    } else {
      alert('Wrong card details entered. Please try again.');
    }
    // window.location.href = 'otp.html';
  };

  // Credit Card Payment Div Open On Click
  const cardPay = () => {
    let rightDiv = `<h3>Add Credit / Debit card</h3>
          <div>
            <p>Card Number</p>
            <input class= "aInput" type="text" id="a_cardNumber" required />
          </div>
          <div id="a_cvv">
            <p>Valid Through</p>
            <p>CVV</p>
            <input type="month" id= "a_valid" class= "aInput"/>
            <input type="number" id= "acvv" class= "aInput"/>
          </div>
          <div>
            <p><input type="checkbox" /> Save this card for faster Payments</p>
            <button onclick="order()" id="a_pay"">Place order & Pay</button>
          </div>`;
    payDetail.innerHTML = rightDiv;
  };

  // Order Summary Details
  let basket = document.getElementById('aBasketPrice');
  let basketValue = document.getElementById('aBasketPrice').innerText;
  let deleveryCharge = document.getElementById('aDeleveryCharge').innerText;
  let totalAmount = document.getElementById('aTotalAmount');
  totalAmount.innerText = +basketValue + +deleveryCharge;


  let p_voucherApplied = false;

  // Apply Voucher
  const apply = (voucher) => {
    let applyVoucher = document.getElementById('aVoucher').value;
    let saving = document.getElementById('aTotalSaving');
    if (applyVoucher == voucher) {
      // let saveMoney = (basketValue * 20) / 100;
      // let finalPrice = basketValue - saveMoney;
      // basket.innerText = finalPrice;
      // totalAmount.innerText = +basket.innerText + +deleveryCharge;
      // saving.innerText = saveMoney;
      p_voucherApplied = true;
      p_calculateTotalAndDisplay();
    } else {
      alert('Invalid Voucher');
    }
  };



  // Function to calculate total price and show it

  let bigBasketCart = JSON.parse(localStorage.getItem("bigBasketCart")) || [];

  const p_calculateTotalAndDisplay = () => {
      let total = bigBasketCart.reduce((acc, el) => {
          return acc + (el.prod_price * el.prod_quantity);
      }, 0)

      let totalSavings = 0;

      for(let item of bigBasketCart){
        if(item.prod_strike_price != 0){
          totalSavings += ((item.prod_strike_price - item.prod_price) * item.prod_quantity);
        }
      }

      

      if(p_voucherApplied){
        total = Math.round(total * 0.8);
      }
      if(p_voucherApplied) totalSavings = totalSavings + Math.round(total*0.2);

      let grand_total = total+50;

      // console.log(typeof(total), typeof(totalSavings));

      document.getElementById("aBasketPrice").textContent = `Rs. ${total}`;

      document.getElementById("aTotalAmount").textContent = `Rs. ${grand_total}`;

      document.getElementById("aTotalSaving").textContent = `Rs. ${totalSavings}`;
  }

  p_calculateTotalAndDisplay();


</script>
